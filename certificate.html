<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<script>
/* ===============================
   CERTIFICATE CORE LOGIC
================================ */

// 1. LIVE NAME (editable + saved)
const nameEl = document.getElementById('certName');
const savedName = localStorage.getItem('ultimate_blackbook_name');

if (savedName) {
    nameEl.textContent = savedName;
}

nameEl.addEventListener('input', () => {
    localStorage.setItem(
        'ultimate_blackbook_name',
        nameEl.textContent.trim()
    );
});

// 2. COMPLETION DATE (auto + locked)
let completionDate = localStorage.getItem('ubb_completion_date');

if (!completionDate) {
    completionDate = new Date().toISOString();
    localStorage.setItem('ubb_completion_date', completionDate);
}

const dateObj = new Date(completionDate);
document.getElementById('certDate').textContent =
    `Completed: ${dateObj.toLocaleDateString('en-ZA', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    })}`;

// 3. CERTIFICATE NUMBER (unique + persistent)
let certNumber = localStorage.getItem('ubb_cert_number');

if (!certNumber) {
    certNumber = `UBB-${Date.now().toString(36).toUpperCase()}`;
    localStorage.setItem('ubb_cert_number', certNumber);
}

document.getElementById('certNumber').textContent =
    `Certificate No: ${certNumber}`;

// 4. QR CODE (auto-generated + live)
const qrContainer = document.getElementById('qrcode');
qrContainer.innerHTML = ''; // reset if reload

const verifyPayload = JSON.stringify({
    cert: certNumber,
    name: nameEl.textContent.trim(),
    date: completionDate
});

new QRCode(qrContainer, {
    text: verifyPayload,
    width: 90,
    height: 90,
    colorDark: "#000000",
    colorLight: "#ffffff"
});

// 5. UPDATE QR WHEN NAME CHANGES (LIVE)
nameEl.addEventListener('input', () => {
    qrContainer.innerHTML = '';

    const updatedPayload = JSON.stringify({
        cert: certNumber,
        name: nameEl.textContent.trim(),
        date: completionDate
    });

    new QRCode(qrContainer, {
        text: updatedPayload,
        width: 90,
        height: 90
    });
});
</script>
