
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<script>
/* ===============================
   CERTIFICATE CORE LOGIC (FINAL)
================================ */

// 1. STUDENT NAME (from Lesson 8)
const nameEl = document.getElementById('certName');
const savedName = localStorage.getItem('studentName'); // from lesson 8

nameEl.textContent = savedName ? savedName : "â€”";

// 2. COMPLETION DATE (auto + persistent)
let completionDate = localStorage.getItem('ubb_completion_date');

if (!completionDate) {
    completionDate = new Date().toISOString();
    localStorage.setItem('ubb_completion_date', completionDate);
}

const dateObj = new Date(completionDate);
document.getElementById('certDate').textContent =
    `Completed: ${dateObj.toLocaleDateString('en-ZA', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    })}`;

// 3. CERTIFICATE NUMBER (unique + persistent)
let certNumber = localStorage.getItem('ubb_cert_number');

if (!certNumber) {
    certNumber = `UBB-${Date.now().toString(36).toUpperCase()}`;
    localStorage.setItem('ubb_cert_number', certNumber);
}

document.getElementById('certNumber').textContent =
    `Certificate No: ${certNumber}`;

// 4. QR CODE (auto-generated)
const qrContainer = document.getElementById('qrcode');
qrContainer.innerHTML = '';

const verifyPayload = JSON.stringify({
    cert: certNumber,
    name: savedName || "",
    date: completionDate
});

new QRCode(qrContainer, {
    text: verifyPayload,
    width: 90,
    height: 90,
    colorDark: "#000000",
    colorLight: "#ffffff"
});
</script>
